{"version":3,"sources":["../../server/controllers/usersController.js"],"names":["UsersController","signup","req","res","checkBody","notEmpty","isLength","min","isEmail","getValidationResult","then","result","isEmpty","status","json","data","array","newUser","username","body","password","hashSync","email","fullname","firstname","lastname","User","create","user","catch","send","err","errors","login","next","authenticate","logout"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;AAEA,IAAMA,kBAAkB;AACpB;AACAC,YAAQ,gBAACC,GAAD,EAAMC,GAAN,EAAc;AAClB;AACAD,YAAIE,SAAJ,CAAc,UAAd,EAA0B,kBAA1B,EAA8CC,QAA9C;AACAH,YAAIE,SAAJ,CAAc,UAAd,EAA0B,kBAA1B,EACKC,QADL,GACgBC,QADhB,CACyB,EAAEC,KAAK,CAAP,EADzB;AAEAL,YAAIE,SAAJ,CAAc,OAAd,EAAuB,eAAvB,EAAwCC,QAAxC,GAAmDG,OAAnD;AACAN,YAAIE,SAAJ,CAAc,WAAd,EAA2B,2BAA3B,EACKC,QADL,GACgBC,QADhB,CACyB,EAAEC,KAAK,CAAP,EADzB;AAEAL,YAAIE,SAAJ,CAAc,UAAd,EAA0B,0BAA1B,EACKC,QADL,GACgBC,QADhB,CACyB,EAAEC,KAAK,CAAP,EADzB;;AAGA;AACAL,YAAIO,mBAAJ,GAA0BC,IAA1B,CAA+B,UAACC,MAAD,EAAY;AACvC,gBAAI,CAACA,OAAOC,OAAP,EAAL,EAAuB;AACnB,uBAAOT,IAAIU,MAAJ,CAAW,GAAX,EACFC,IADE,CACG,EAAED,QAAQ,kBAAV,EAA8BE,MAAMJ,OAAOK,KAAP,EAApC,EADH,CAAP;AAEH;;AAED,gBAAMC,UAAU;AACZC,0BAAUhB,IAAIiB,IAAJ,CAASD,QADP;AAEZE,0BAAU,mBAAOC,QAAP,CAAgBnB,IAAIiB,IAAJ,CAASC,QAAzB,EAAmC,CAAnC,CAFE;AAGZE,uBAAOpB,IAAIiB,IAAJ,CAASG,KAHJ;AAIZC,0BAAarB,IAAIiB,IAAJ,CAASK,SAAtB,SAAmCtB,IAAIiB,IAAJ,CAASM;AAJhC,aAAhB;;AAOA,6BAAGC,IAAH,CACKC,MADL,CACYV,OADZ,EAEKP,IAFL,CAEU;AAAA,uBAAQP,IAAIU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC/BD,4BAAQ,SADuB;AAE/BE,0BAAMa;AAFyB,iBAArB,CAAR;AAAA,aAFV,EAMKC,KANL,CAMW;AAAA,uBAAO1B,IAAIU,MAAJ,CAAW,GAAX,EAAgBiB,IAAhB,CAAqBC,IAAIC,MAAzB,CAAP;AAAA,aANX;AAOH,SApBD;AAqBH,KAnCmB;;AAqCpB;AACAC,WAAO,eAAC/B,GAAD,EAAMC,GAAN,EAAW+B,IAAX,EAAoB;AACvB,2BAASC,YAAT,CAAsB,OAAtB,EAA+B,UAACJ,GAAD,EAAMH,IAAN,EAAe;AAC1C,gBAAIG,GAAJ,EAAS,OAAOG,KAAKH,GAAL,CAAP;AACT,gBAAI,CAACH,IAAL,EAAW;AACP,uBAAOzB,IAAIU,MAAJ,CAAW,GAAX,EAAgBiB,IAAhB,CAAqB;AACxBjB,4BAAQ;AADgB,iBAArB,CAAP;AAGH;AACDX,gBAAI+B,KAAJ,CAAUL,IAAV,EAAgB,UAACG,GAAD,EAAS;AACrB,oBAAIA,GAAJ,EAAS,OAAOG,KAAKH,GAAL,CAAP;AACT,uBAAO5B,IAAIU,MAAJ,CAAW,GAAX,EAAgBiB,IAAhB,CAAqB;AACxBjB,4BAAQ,WADgB;AAExBE,0BAAMa;AAFkB,iBAArB,CAAP;AAIH,aAND;AAOH,SAdD,EAcG1B,GAdH,EAcQC,GAdR,EAca+B,IAdb;AAeH,KAtDmB;;AAwDpB;AACAE,YAAQ,gBAAClC,GAAD,EAAMC,GAAN,EAAc;AAClBD,YAAIkC,MAAJ;AACAjC,YAAIU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAED,QAAQ,YAAV,EAArB;AACH;AA5DmB,CAAxB;;kBA+Deb,e","file":"usersController.js","sourcesContent":["import bcrypt from 'bcryptjs';\r\nimport passport from 'passport';\r\n\r\nimport db from '../models';\r\n\r\nconst UsersController = {\r\n    /* Register / create user account */\r\n    signup: (req, res) => {\r\n        // Validate input\r\n        req.checkBody('username', 'Invalid username').notEmpty();\r\n        req.checkBody('password', 'Invalid password')\r\n            .notEmpty().isLength({ min: 5 });\r\n        req.checkBody('email', 'Invalid email').notEmpty().isEmail();\r\n        req.checkBody('firstname', 'Invalid entry - Firstname')\r\n            .notEmpty().isLength({ min: 2 });\r\n        req.checkBody('lastname', 'Invalid entry - Lastname')\r\n            .notEmpty().isLength({ min: 2 });\r\n\r\n        // Validation result\r\n        req.getValidationResult().then((result) => {\r\n            if (!result.isEmpty()) {\r\n                return res.status(400)\r\n                    .json({ status: 'Validation error', data: result.array() });\r\n            }\r\n\r\n            const newUser = {\r\n                username: req.body.username,\r\n                password: bcrypt.hashSync(req.body.password, 8),\r\n                email: req.body.email,\r\n                fullname: `${req.body.firstname} ${req.body.lastname}`\r\n            };\r\n\r\n            db.User\r\n                .create(newUser)\r\n                .then(user => res.status(201).json({\r\n                    status: 'success',\r\n                    data: user\r\n                }))\r\n                .catch(err => res.status(400).send(err.errors));\r\n        });\r\n    },\r\n\r\n    /* Login user */\r\n    login: (req, res, next) => {\r\n        passport.authenticate('local', (err, user) => {\r\n            if (err) return next(err);\r\n            if (!user) {\r\n                return res.status(500).send({\r\n                    status: 'Invalid credentials'\r\n                });\r\n            }\r\n            req.login(user, (err) => {\r\n                if (err) return next(err);\r\n                return res.status(200).send({\r\n                    status: 'Logged in',\r\n                    data: user\r\n                });\r\n            });\r\n        })(req, res, next);\r\n    },\r\n\r\n    /* logout user */\r\n    logout: (req, res) => {\r\n        req.logout();\r\n        res.status(200).json({ status: 'Logged out' });\r\n    }\r\n};\r\n\r\nexport default UsersController;\r\n"]}